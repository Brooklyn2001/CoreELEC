From b81b4413043475edd5b131947ea798f1c696cd13 Mon Sep 17 00:00:00 2001
From: fritsch <Peter.Fruehberger@gmail.com>
Date: Wed, 24 Oct 2018 22:01:17 +0200
Subject: [PATCH 1/2] Resolution: Use v17 behaviour if whitelist is not present

---
 xbmc/windowing/Resolution.cpp | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/xbmc/windowing/Resolution.cpp b/xbmc/windowing/Resolution.cpp
index 31a408fa6b55..c6d9ca8263af 100644
--- a/xbmc/windowing/Resolution.cpp
+++ b/xbmc/windowing/Resolution.cpp
@@ -75,6 +75,22 @@ void CResolutionUtils::FindResolutionFromWhitelist(float fps, int width, int hei
   RESOLUTION_INFO curr = CServiceBroker::GetWinSystem()->GetGfxContext().GetResInfo(resolution);
 
   std::vector<CVariant> indexList = CServiceBroker::GetSettingsComponent()->GetSettings()->GetList(CSettings::SETTING_VIDEOSCREEN_WHITELIST);
+  if (indexList.empty())
+  {
+    CLog::Log(LOGDEBUG, "Whitelist is empty using default one");
+    std::vector<RESOLUTION> candidates;
+    RESOLUTION_INFO info;
+    CServiceBroker::GetWinSystem()->GetGfxContext().GetAllowedResolutions(candidates);
+    for (const auto& c : candidates)
+    {
+      info = CServiceBroker::GetWinSystem()->GetGfxContext().GetResInfo(c);
+      if (info.iScreenHeight >= curr.iScreenHeight && info.iScreenWidth >= curr.iScreenWidth &&
+          (info.dwFlags & D3DPRESENTFLAG_MODEMASK) == (curr.dwFlags & D3DPRESENTFLAG_MODEMASK))
+      {
+        indexList.push_back(info.strMode);
+      }
+    }
+  }
 
   CLog::Log(LOGDEBUG, "Trying to find exact refresh rate");
 

From 1dc84d0321af16ba2c7da307b98a890bf2624efc Mon Sep 17 00:00:00 2001
From: fritsch <Peter.Fruehberger@gmail.com>
Date: Thu, 25 Oct 2018 20:39:57 +0200
Subject: [PATCH 2/2] Settings: Make Whitelist Expert level

---
 system/settings/settings.xml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/system/settings/settings.xml b/system/settings/settings.xml
index 395d5816c2ba..27916231b603 100755
--- a/system/settings/settings.xml
+++ b/system/settings/settings.xml
@@ -2090,7 +2090,7 @@
           <control type="spinner" format="string" delayed="true" />
         </setting>
         <setting id="videoscreen.whitelist" type="list[string]" parent="videoscreen.screen" label="14085" help="36356">
-          <level>1</level>
+          <level>3</level>
           <constraints>
             <options>modes</options>
             <default></default>
